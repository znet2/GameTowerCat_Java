@startuml TowerDefenseGame

skinparam classAttributeIconSize 0
skinparam packageStyle rectangle

title CattackOnCican - UML Class Diagram

' ============= Main Package =============
package "com.game.main" {
    class Main {
        + {static} main(String[]): void
        - {static} createAndShowGameWindow(): void
        - {static} configureWindow(JFrame): void
        - {static} finalizeWindow(JFrame): void
    }
}

' ============= Core Package =============
package "com.game.core" {
    class MenuPanel {
        - JFrame parentFrame
        - Image wallpaperImage
        - Image startButtonImage
        - Image logoImage
        - Rectangle startButtonBounds
        + MenuPanel(JFrame)
        - loadImages(): void
        - setupPanel(): void
        # paintComponent(Graphics): void
        - handleMouseClick(MouseEvent): void
        - startGame(): void
    }

    class GamePanel {
        - Thread gameLoopThread
        - JFrame parentFrame
        - Map gameMap
        - ArrayList<BaseEnemy> activeEnemies
        - CoinManager coinManager
        - WaveManager waveManager
        - boolean isGameOver
        - boolean isWin
        + GamePanel(JFrame)
        - initializeGameComponents(): void
        - setupUserInterface(): void
        - startGameLoop(): void
        + run(): void
        - update(): void
        - checkGameOver(): void
        - checkWinCondition(): void
        # paintComponent(Graphics): void
        - renderHeroBar(Graphics): void
        - renderUnitIcons(Graphics): void
        + mousePressed(MouseEvent): void
        + mouseReleased(MouseEvent): void
        + mouseDragged(MouseEvent): void
    }

    class GameOverPanel {
        - JFrame parentFrame
        - boolean isWin
        - Image backgroundImage
        - Image resultImage
        - Image restartButtonImage
        + GameOverPanel(JFrame, boolean)
        - loadImages(): void
        - setupPanel(): void
        # paintComponent(Graphics): void
        - handleMouseClick(MouseEvent): void
        - restartGame(): void
    }
}

' ============= Utils Package =============
package "com.game.utils" {
    class Constants <<utility>> {
        ' Game configuration constants
        ' Nested classes: Game, Map, Entities
        ' Projectiles, UI, Economy, Waves, Paths
    }

    class MathUtils <<utility>> {
        + {static} calculateDistance(double, double, double, double): double
        + {static} pixelToGrid(int, int): int
        + {static} isWithinBounds(int, int, int, int): boolean
    }

    class ImageLoader <<utility>> {
        + {static} loadImage(String): BufferedImage
    }
}

' ============= Managers Package =============
package "com.game.managers" {
    class CoinManager {
        - int currentCoins
        + CoinManager()
        + getCurrentCoins(): int
        + addCoins(int): void
        + spendCoins(int): boolean
        + canAfford(int): boolean
        + awardCoinsForEnemyKill(): void
        + awardCoinsForBossKill(): void
        + awardCoinsForWaveComplete(): void
        + renderCoinDisplay(Graphics, int, int): void
        + resetCoins(): void
    }

    class WaveManager {
        - int currentWaveNumber
        - int enemiesToSpawnInWave
        - Map gameMap
        - ArrayList<BaseEnemy> activeEnemies
        - CoinManager coinManager
        + WaveManager(Map, ArrayList<BaseEnemy>, CoinManager)
        + startNextWave(): void
        + update(): void
        + isWaveFinished(): boolean
        + getCurrentWave(): int
        + isGameWon(): boolean
        - calculateEnemiesForWave(): void
        - spawnEnemy(): void
    }
}

' ============= World Package =============
package "com.game.world" {
    class Map {
        - ArrayList<GameObject> mapObjects
        - ArrayList<Tank> defensiveTanks
        - ArrayList<Magic> magicTowers
        - ArrayList<Archer> archerTowers
        - ArrayList<Assassin> assassins
        - int[][] mapGrid
        + Map()
        - loadImages(): void
        - initializeMapObjects(): void
        # paintComponent(Graphics): void
        + getRawMap(): int[][]
        + getTileSize(): int
        + getHouse(): House
        + placeTank(int, int): void
        + placeMagic(int, int, ArrayList<BaseEnemy>): void
        + placeArcher(int, int, ArrayList<BaseEnemy>): void
        + placeAssassin(int, int, ArrayList<BaseEnemy>): void
        + updateMagicTowers(): void
        + updateArcherTowers(): void
        + updateAssassins(): void
    }
}

' ============= Base Entities Package =============
package "com.game.entities.base" {
    abstract class GameObject {
        # int positionX
        # int positionY
        # int objectWidth
        # int objectHeight
        # Image objectImage
        + GameObject(int, int, int, int, int, Image)
        + draw(Graphics): void
        + getGridColumn(int): int
        + getGridRow(int): int
    }

    interface Collidable {
        + getCollisionBounds(): Rectangle
    }

    interface Defensive {
        + takeDamage(int): void
        + isDestroyed(): boolean
        + getCurrentHealth(): int
        + getMaxHealth(): int
        + getDefenseRating(): int
        + isDead(): boolean
    }
}

' ============= Defensive Units Package =============
package "com.game.entities.defensive" {
    class House {
        - int currentHealth
        + House(int, int, int, Image)
        + takeDamage(int): void
        + isDestroyed(): boolean
        + getCurrentHealth(): int
        + getMaxHealth(): int
        + getBounds(): Rectangle
        + draw(Graphics): void
    }

    class Tank {
        - int currentHealth
        - boolean hasBeenAttacked
        - Image normalImage
        - Image defendImage
        + Tank(int, int, int, Image)
        + update(): void
        + takeDamage(int): void
        + isDestroyed(): boolean
        + getBounds(): Rectangle
        + draw(Graphics): void
        - drawHealthBar(Graphics): void
    }

    class Magic {
        - int currentHealth
        - BaseEnemy lockedTarget
        - int attackTimer
        - int attackCounter
        - boolean isUsingSpecialSpell
        - ArrayList<BaseEnemy> enemyList
        - ArrayList<MagicBall> magicBalls
        + Magic(int, int, int, Image, ArrayList<BaseEnemy>)
        + update(): void
        - isTargetValid(): boolean
        - acquireNewTarget(): void
        - performAttack(): void
        - executeAttack(): void
        - performNormalAttack(): void
        - castSpecialSpell(): void
        - shootMagicBall(boolean): void
        + takeDamage(int): void
        + getBounds(): Rectangle
        + draw(Graphics): void
        - drawHealthBar(Graphics): void
    }

    class Archer {
        - int currentHealth
        - BaseEnemy lockedTarget
        - int attackTimer
        - boolean isAttacking
        - ArrayList<BaseEnemy> enemyList
        - ArrayList<Arrow> arrows
        + Archer(int, int, int, Image, ArrayList<BaseEnemy>)
        + update(): void
        - isTargetValid(): boolean
        - acquireNewTarget(): void
        - performAttack(): void
        - shootArrow(): void
        + takeDamage(int): void
        + getBounds(): Rectangle
        + draw(Graphics): void
        - drawHealthBar(Graphics): void
    }

    class Assassin {
        - ArrayList<BaseEnemy> enemyList
        - ArrayList<BaseEnemy> attackedEnemies
        - int attackCooldown
        - boolean isAttacking
        + Assassin(int, int, int, Image, ArrayList<BaseEnemy>)
        + update(): void
        - calculateDistanceToEnemy(BaseEnemy): double
        - attackEnemy(BaseEnemy): void
        + draw(Graphics): void
    }
}

' ============= Enemies Package =============
package "com.game.entities.enemies" {
    abstract class BaseEnemy {
        # double positionX
        # double positionY
        # ArrayList<Point> movementPath
        # Map gameMap
        # House targetHouse
        # CoinManager coinManager
        # boolean isAttacking
        # boolean isDead
        # int currentHealth
        # BaseEnemy(Map, CoinManager, int)
        # {abstract} getMaxHealth(): int
        # {abstract} getAttackDamage(): int
        # {abstract} getAttackCooldown(): int
        # {abstract} getSpeed(): double
        # {abstract} getSize(): int
        # {abstract} getIdleImage(): Image
        # {abstract} getWalkImage(): Image
        # {abstract} getAttackImage(): Image
        # {abstract} getCoinReward(): int
        # buildMovementPath(): void
        + update(): void
        + takeDamage(int): void
        + isDead(): boolean
        + getBounds(): Rectangle
        + draw(Graphics): void
    }

    class Enemy {
        - Image idleImage
        - Image walkImage
        - Image attackImage
        + Enemy(Map, CoinManager)
        # getMaxHealth(): int
        # getAttackDamage(): int
        # getAttackCooldown(): int
        # getSpeed(): double
        # getSize(): int
        # getIdleImage(): Image
        # getWalkImage(): Image
        # getAttackImage(): Image
        # getCoinReward(): int
    }

    class EnemyBoss {
        - Image idleImage
        - Image flyImage
        - Image attackImage
        - Image skillImage
        - ArrayList<BossSkillBall> skillBalls
        + EnemyBoss(Map, CoinManager)
        + update(): void
        - useSkill(): void
        + draw(Graphics): void
        # getMaxHealth(): int
        # getAttackDamage(): int
        # getAttackCooldown(): int
        # getSpeed(): double
        # getSize(): int
        # getIdleImage(): Image
        # getWalkImage(): Image
        # getAttackImage(): Image
        # getCoinReward(): int
    }
}

' ============= Projectiles Package =============
package "com.game.entities.projectiles" {
    abstract class Projectile {
        # double positionX
        # double positionY
        # BaseEnemy target
        # int damage
        # boolean isActive
        # Image projectileImage
        + Projectile(double, double, BaseEnemy, int, Image)
        + update(): void
        # hitTarget(): void
        + draw(Graphics): void
        + isActive(): boolean
        # {abstract} getSpeed(): double
        # {abstract} getSize(): int
        # {abstract} getFallbackColor(): Color
        # {abstract} getFallbackSize(): int
    }

    class Arrow {
        + Arrow(double, double, BaseEnemy, int, Image)
        # getSpeed(): double
        # getSize(): int
        # getFallbackColor(): Color
        # getFallbackSize(): int
    }

    class MagicBall {
        + MagicBall(double, double, BaseEnemy, int, Image)
        # getSpeed(): double
        # getSize(): int
        # getFallbackColor(): Color
        # getFallbackSize(): int
    }

    class BossSkillBall {
        - double positionX
        - double positionY
        - double velocityX
        - double velocityY
        - int damage
        - boolean isActive
        - ArrayList<Defensive> defensiveUnits
        + BossSkillBall(double, double, double, int, Image, ArrayList<Defensive>)
        + update(): void
        - checkCollisions(): void
        - getUnitBounds(Defensive): Rectangle
        - hitTarget(Defensive): void
        + draw(Graphics): void
        - getBounds(): Rectangle
        + isActive(): boolean
    }
}

' ============= Relationships =============

' Main Flow
Main --> MenuPanel
MenuPanel --> GamePanel
GamePanel --> GameOverPanel

' GamePanel Dependencies
GamePanel --> Map
GamePanel --> CoinManager
GamePanel --> WaveManager
GamePanel --> BaseEnemy

' WaveManager Dependencies
WaveManager --> Map
WaveManager --> CoinManager
WaveManager --> Enemy
WaveManager --> EnemyBoss

' Map Dependencies
Map --> House
Map --> Tank
Map --> Magic
Map --> Archer
Map --> Assassin

' Inheritance - GameObject
GameObject <|-- House
GameObject <|-- Tank
GameObject <|-- Magic
GameObject <|-- Archer
GameObject <|-- Assassin

' Interface Implementation - Defensive
Defensive <|.. House
Defensive <|.. Tank
Defensive <|.. Magic
Defensive <|.. Archer

' Interface Implementation - Collidable
Collidable <|.. Tank
Collidable <|.. Magic
Collidable <|.. Archer

' Inheritance - Enemies
BaseEnemy <|-- Enemy
BaseEnemy <|-- EnemyBoss

' Inheritance - Projectiles
Projectile <|-- Arrow
Projectile <|-- MagicBall

' Combat Relationships
Magic --> MagicBall
Archer --> Arrow
EnemyBoss --> BossSkillBall
Projectile --> BaseEnemy
BossSkillBall --> Defensive

' Enemy Interactions
BaseEnemy --> Map
BaseEnemy --> House
BaseEnemy --> CoinManager

' Utility Usage
GamePanel ..> Constants
Map ..> Constants
BaseEnemy ..> MathUtils
MenuPanel ..> ImageLoader
GameOverPanel ..> ImageLoader
Map ..> ImageLoader

@enduml
