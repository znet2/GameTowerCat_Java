@startuml CattackOnCican

' ============= Main Package =============
package "com.game.main" {
    class Main {
        + {static} main(String[] args): void
        - {static} createAndShowGameWindow(): void
        - {static} configureWindow(JFrame): void
        - {static} finalizeWindow(JFrame): void
    }
}

' ============= Core Package =============
package "com.game.core" {
    class MenuPanel {
        - JFrame parentFrame
        - Image wallpaperImage
        - Image startButtonImage
        - Image logoImage
        - Rectangle startButtonBounds
        + MenuPanel(JFrame)
        - loadImages(): void
        - setupPanel(): void
        # paintComponent(Graphics): void
        - handleMouseClick(MouseEvent): void
        - startGame(): void
    }

    class GamePanel {
        - Thread gameLoopThread
        - JFrame parentFrame
        - Map gameMap
        - ArrayList<BaseEnemy> activeEnemies
        - CoinManager coinManager
        - WaveManager waveManager
        - boolean isGameOver
        - boolean isWin
        - Rectangle heroBarArea
        - Rectangle tankIconArea
        - Rectangle magicIconArea
        - Rectangle archerIconArea
        - Rectangle assassinIconArea
        - boolean isDraggingTank
        - boolean isDraggingMagic
        - boolean isDraggingArcher
        - boolean isDraggingAssassin
        - int dragPositionX
        - int dragPositionY
        + GamePanel(JFrame)
        - initializeGameComponents(): void
        - setupUserInterface(): void
        - configurePanel(): void
        - startGameLoop(): void
        + run(): void
        - update(): void
        - checkGameOver(): void
        - checkWinCondition(): void
        - showGameOver(boolean): void
        # paintComponent(Graphics): void
        - renderHeroBar(Graphics): void
        - renderUnitIcons(Graphics): void
        - renderDragPreview(Graphics): void
        - renderHouseHealthBar(Graphics): void
        + mousePressed(MouseEvent): void
        + mouseReleased(MouseEvent): void
        + mouseDragged(MouseEvent): void
        + mouseClicked(MouseEvent): void
        + mouseMoved(MouseEvent): void
        + mouseEntered(MouseEvent): void
        + mouseExited(MouseEvent): void
        - isRoadTile(int, int): boolean
        - canPlaceUnit(int, int): boolean
    }

    class GameOverPanel {
        - JFrame parentFrame
        - boolean isWin
        - Image backgroundImage
        - Image resultImage
        - Image restartButtonImage
        - Rectangle restartButtonBounds
        + GameOverPanel(JFrame, boolean)
        - loadImages(): void
        - setupPanel(): void
        # paintComponent(Graphics): void
        - handleMouseClick(MouseEvent): void
        - restartGame(): void
    }
}

' ============= Utils Package =============
package "com.game.utils" {
    class Constants <<utility>> {
        ' Contains nested static classes:
        ' Game, Map, Entities, Projectiles
        ' UI, Economy, Waves, Paths
    }

    class MathUtils {
        + {static} calculateDistance(double, double, double, double): double
        + {static} pixelToGrid(int, int): int
        + {static} isWithinBounds(int, int, int, int): boolean
    }

    class ImageLoader {
        + {static} loadImage(String): BufferedImage
    }
}

' ============= Managers Package =============
package "com.game.managers" {
    class CoinManager {
        - int currentCoins
        + CoinManager()
        + getCurrentCoins(): int
        + addCoins(int): void
        + spendCoins(int): boolean
        + canAfford(int): boolean
        + awardCoinsForEnemyKill(): void
        + awardCoinsForBossKill(): void
        + awardCoinsForWaveComplete(): void
        + renderCoinDisplay(Graphics, int, int): void
        + resetCoins(): void
    }

    class WaveManager {
        - int currentWaveNumber
        - int enemiesToSpawnInWave
        - int enemiesSpawnedInWave
        - int spawnTimer
        - boolean isCurrentlySpawning
        - Map gameMap
        - ArrayList<BaseEnemy> activeEnemies
        - CoinManager coinManager
        + WaveManager(Map, ArrayList<BaseEnemy>, CoinManager)
        + startNextWave(): void
        + update(): void
        + isWaveFinished(): boolean
        + getCurrentWave(): int
        + isGameWon(): boolean
        - calculateEnemiesForWave(): void
        - calculateBossCount(): int
        - shouldHaveBoss(): boolean
        - spawnEnemy(): void
        - shouldSpawnBoss(): boolean
    }
}

' ============= World Package =============
package "com.game.world" {
    class Map {
        - ArrayList<GameObject> mapObjects
        - ArrayList<Tank> defensiveTanks
        - ArrayList<Magic> magicTowers
        - ArrayList<Archer> archerTowers
        - ArrayList<Assassin> assassins
        - int[][] mapGrid
        - Image houseImage
        - Image tankImage
        - Image magicImage
        - Image archerImage
        - Image assassinImage
        - Image grassTile
        - Image roadTile
        - Image waterTile
        - Image waterUpTile
        - Image waterDownTile
        - Image waterLeftTile
        - Image waterRightTile
        - Image treeTile
        + Map()
        - loadImages(): void
        - initializeMapObjects(): void
        - configurePanel(): void
        # paintComponent(Graphics): void
        - renderMapTiles(Graphics): void
        - getTileImage(int): Image
        - renderMapObjects(Graphics): void
        - renderTanks(Graphics): void
        - renderMagicTowers(Graphics): void
        - renderArcherTowers(Graphics): void
        - renderAssassins(Graphics): void
        + getRawMap(): int[][]
        + getTileSize(): int
        + getMapWidth(): int
        + getMapHeight(): int
        + draw(Graphics): void
        + getTileAtPixel(double, double): int
        + getHouse(): House
        + placeTank(int, int): void
        + placeMagic(int, int, ArrayList<BaseEnemy>): void
        + placeArcher(int, int, ArrayList<BaseEnemy>): void
        + placeAssassin(int, int, ArrayList<BaseEnemy>): void
        + updateMagicTowers(): void
        + updateArcherTowers(): void
        + updateAssassins(): void
        + getTanks(): ArrayList<Tank>
        + getMagicTowers(): ArrayList<Magic>
        + getArcherTowers(): ArrayList<Archer>
        + removeDeadTanks(): void
        + removeDeadMagicTowers(): void
        + removeDeadArcherTowers(): void
    }
}

' ============= Base Entities Package =============
package "com.game.entities.base" {
    abstract class GameObject {
        # int positionX
        # int positionY
        # int objectWidth
        # int objectHeight
        # Image objectImage
        + GameObject(int, int, int, int, int, Image)
        + draw(Graphics): void
        + getGridColumn(int): int
        + getGridRow(int): int
    }

    interface Collidable {
        + getCollisionBounds(): Rectangle
    }

    interface Defensive {
        + takeDamage(int): void
        + isDestroyed(): boolean
        + getCurrentHealth(): int
        + getMaxHealth(): int
        + getDefenseRating(): int
        + getHealthPercentage(): double
        + damage(int): void
        + isDead(): boolean
    }
}

' ============= Defensive Units Package =============
package "com.game.entities.defensive" {
    class House {
        - int currentHealth
        + House(int, int, int, Image)
        + takeDamage(int): void
        + isDestroyed(): boolean
        + getCurrentHealth(): int
        + getMaxHealth(): int
        + getBounds(): Rectangle
        + getHealth(): int
        + draw(Graphics): void
    }

    class Tank {
        - int currentHealth
        - boolean hasBeenAttacked
        - Image normalImage
        - Image defendImage
        + Tank(int, int, int, Image)
        + update(): void
        + takeDamage(int): void
        + isDestroyed(): boolean
        + getCurrentHealth(): int
        + getMaxHealth(): int
        + getDefenseRating(): int
        + getCollisionBounds(): Rectangle
        + getBounds(): Rectangle
        + draw(Graphics): void
        - drawHealthBar(Graphics): void
    }

    class Magic {
        - int currentHealth
        - BaseEnemy lockedTarget
        - int attackTimer
        - int attackCounter
        - boolean isUsingSpecialSpell
        - int spellAnimationTimer
        - ArrayList<BaseEnemy> enemyList
        - ArrayList<MagicBall> magicBalls
        - Image normalImage
        - Image bombImage
        - Image normalBallImage
        - Image superBallImage
        + Magic(int, int, int, Image, ArrayList<BaseEnemy>)
        + update(): void
        - isTargetValid(): boolean
        - acquireNewTarget(): void
        - calculateDistanceToTarget(BaseEnemy): double
        - getEnemyBounds(BaseEnemy): Rectangle
        - performAttack(): void
        - executeAttack(): void
        - performNormalAttack(): void
        - castSpecialSpell(): void
        - shootMagicBall(boolean): void
        + takeDamage(int): void
        + isDestroyed(): boolean
        + getCurrentHealth(): int
        + getMaxHealth(): int
        + getDefenseRating(): int
        + getCollisionBounds(): Rectangle
        + getBounds(): Rectangle
        + draw(Graphics): void
        - drawHealthBar(Graphics): void
    }

    class Archer {
        - int currentHealth
        - BaseEnemy lockedTarget
        - int attackTimer
        - boolean isAttacking
        - int attackAnimationTimer
        - ArrayList<BaseEnemy> enemyList
        - ArrayList<Arrow> arrows
        - Image normalImage
        - Image attackImage
        - Image arrowImage
        + Archer(int, int, int, Image, ArrayList<BaseEnemy>)
        + update(): void
        - isTargetValid(): boolean
        - acquireNewTarget(): void
        - calculateDistanceToTarget(BaseEnemy): double
        - performAttack(): void
        - shootArrow(): void
        + takeDamage(int): void
        + isDestroyed(): boolean
        + getCurrentHealth(): int
        + getMaxHealth(): int
        + getDefenseRating(): int
        + getCollisionBounds(): Rectangle
        + getBounds(): Rectangle
        + draw(Graphics): void
        - drawHealthBar(Graphics): void
    }

    class Assassin {
        - ArrayList<BaseEnemy> enemyList
        - ArrayList<BaseEnemy> attackedEnemies
        - int attackCooldown
        - boolean isAttacking
        - int attackAnimationTimer
        - Image normalImage
        - Image attackImage
        + Assassin(int, int, int, Image, ArrayList<BaseEnemy>)
        + update(): void
        - calculateDistanceToEnemy(BaseEnemy): double
        - attackEnemy(BaseEnemy): void
        + draw(Graphics): void
    }
}

' ============= Enemies Package =============
package "com.game.entities.enemies" {
    abstract class BaseEnemy {
        # double positionX
        # double positionY
        # ArrayList<Point> movementPath
        # int currentPathIndex
        # Map gameMap
        # House targetHouse
        # CoinManager coinManager
        # boolean isAttacking
        # int attackTimer
        # Object currentAttackTarget
        # boolean isDead
        # int currentHealth
        # int animationTimer
        # boolean useAlternateFrame
        # ArrayList<BaseEnemy> allEnemies
        # BaseEnemy(Map, CoinManager, int)
        # {abstract} getMaxHealth(): int
        # {abstract} getAttackDamage(): int
        # {abstract} getAttackCooldown(): int
        # {abstract} getSpeed(): double
        # {abstract} getSize(): int
        # {abstract} getXOffset(): int
        # {abstract} getYOffset(): int
        # {abstract} getIdleImage(): Image
        # {abstract} getWalkImage(): Image
        # {abstract} getAttackImage(): Image
        # {abstract} getCoinReward(): int
        # buildMovementPath(): void
        # findRoadStartPosition(int[][]): Point
        # findHousePosition(int[][]): Point
        # createPathUsingBFS(int[][], int, Point, Point): void
        # reconstructPath(Point[][], Point, Point, int): void
        - initializeStartingPosition(): void
        + update(): void
        - updateMovement(): void
        - moveTowardsNextPoint(): void
        - checkForBlockingEnemies(): boolean
        - findNearestDefensiveTarget(): void
        - updateAttack(): void
        # getCurrentImage(): Image
        + takeDamage(int): void
        + isDead(): boolean
        + getBounds(): Rectangle
        + draw(Graphics): void
        # drawHealthBar(Graphics): void
        + setAllEnemies(ArrayList<BaseEnemy>): void
    }

    class Enemy {
        - Image idleImage
        - Image walkImage
        - Image attackImage
        + Enemy(Map, CoinManager)
        # getMaxHealth(): int
        # getAttackDamage(): int
        # getAttackCooldown(): int
        # getSpeed(): double
        # getSize(): int
        # getXOffset(): int
        # getYOffset(): int
        # getIdleImage(): Image
        # getWalkImage(): Image
        # getAttackImage(): Image
        # getCoinReward(): int
    }

    class EnemyBoss {
        - Image idleImage
        - Image flyImage
        - Image attackImage
        - Image skillImage
        - Image skillBallImage
        - int skillCooldownTimer
        - boolean isUsingSkill
        - int skillAnimationTimer
        - ArrayList<BossSkillBall> skillBalls
        + EnemyBoss(Map, CoinManager)
        + update(): void
        - updateSkillBalls(): void
        - useSkill(): void
        + draw(Graphics): void
        - getCurrentBossImage(): Image
        # getMaxHealth(): int
        # getAttackDamage(): int
        # getAttackCooldown(): int
        # getSpeed(): double
        # getSize(): int
        # getXOffset(): int
        # getYOffset(): int
        # getIdleImage(): Image
        # getWalkImage(): Image
        # getAttackImage(): Image
        # getCoinReward(): int
    }
}

' ============= Projectiles Package =============
package "com.game.entities.projectiles" {
    abstract class Projectile {
        # double positionX
        # double positionY
        # BaseEnemy target
        # int damage
        # boolean isActive
        # Image projectileImage
        + Projectile(double, double, BaseEnemy, int, Image)
        + update(): void
        # hitTarget(): void
        + draw(Graphics): void
        + isActive(): boolean
        # {abstract} getSpeed(): double
        # {abstract} getSize(): int
        # {abstract} getFallbackColor(): Color
        # {abstract} getFallbackSize(): int
    }

    class Arrow {
        + Arrow(double, double, BaseEnemy, int, Image)
        # getSpeed(): double
        # getSize(): int
        # getFallbackColor(): Color
        # getFallbackSize(): int
    }

    class MagicBall {
        + MagicBall(double, double, BaseEnemy, int, Image)
        # getSpeed(): double
        # getSize(): int
        # getFallbackColor(): Color
        # getFallbackSize(): int
    }

    class BossSkillBall {
        - double positionX
        - double positionY
        - double velocityX
        - double velocityY
        - int damage
        - boolean isActive
        - Image ballImage
        - ArrayList<Defensive> defensiveUnits
        + BossSkillBall(double, double, double, int, Image, ArrayList<Defensive>)
        + update(): void
        - checkCollisions(): void
        - getUnitBounds(Defensive): Rectangle
        - hitTarget(Defensive): void
        + draw(Graphics): void
        - getBounds(): Rectangle
        + isActive(): boolean
    }
}

' ============= Relationships =============

left to right direction
skinparam linetype ortho
skinparam packageStyle rectangle

' ================= ARCHITECTURE FLOW =================

Main --> MenuPanel : creates
MenuPanel --> GamePanel : starts
GamePanel --> GameOverPanel : shows

' ================= CORE DEPENDENCIES =================

GamePanel o-- Map
GamePanel o-- CoinManager
GamePanel o-- WaveManager
GamePanel o-- BaseEnemy

WaveManager --> Enemy
WaveManager --> EnemyBoss

' ================= WORLD STRUCTURE =================

Map *-- House
Map *-- Tank
Map *-- Magic
Map *-- Archer
Map *-- Assassin

' ================= INHERITANCE =================

GameObject <|-- House
GameObject <|-- Tank
GameObject <|-- Magic
GameObject <|-- Archer
GameObject <|-- Assassin

BaseEnemy <|-- Enemy
BaseEnemy <|-- EnemyBoss

Projectile <|-- Arrow
Projectile <|-- MagicBall

' ================= INTERFACES =================

Defensive <|.. House
Defensive <|.. Tank
Defensive <|.. Magic
Defensive <|.. Archer

Collidable <|.. Tank
Collidable <|.. Magic
Collidable <|.. Archer

' ================= ATTACK RELATIONS =================

BaseEnemy --> House
BaseEnemy --> Tank
BaseEnemy --> Magic
BaseEnemy --> Archer

Magic --> MagicBall
Archer --> Arrow
Assassin --> BaseEnemy

EnemyBoss --> BossSkillBall
Projectile --> BaseEnemy
BossSkillBall --> Defensive

' ================= UTILITIES =================

GamePanel ..> Constants
Map ..> Constants
BaseEnemy ..> Constants

BaseEnemy ..> MathUtils
Magic ..> MathUtils
Archer ..> MathUtils
Assassin ..> MathUtils

MenuPanel ..> ImageLoader
GameOverPanel ..> ImageLoader
Map ..> ImageLoader
Tank ..> ImageLoader
Magic ..> ImageLoader
Archer ..> ImageLoader
Assassin ..> ImageLoader
Enemy ..> ImageLoader
EnemyBoss ..> ImageLoader

@enduml
